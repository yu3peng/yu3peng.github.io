<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>DOCKERD CLI 代码解析 &mdash; Yu Peng</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/rouge-themes@master/dist/github.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="https://y2p.cc/2017/03/16/dockerd-cli/"><link rel="alternate" type="application/atom+xml" title="Yu Peng" href="https://y2p.cc/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/favicon.ico"><meta property="og:title" content="DOCKERD CLI 代码解析"><meta name="keywords" content="yupeng"><meta name="og:keywords" content="yupeng"><meta name="description" content="DOCKERD CLI 代码解析"><meta name="og:description" content="DOCKERD CLI 代码解析"><meta property="og:url" content="https://y2p.cc/2017/03/16/dockerd-cli/"><meta property="og:site_name" content="Yu Peng"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2017-03-16"> <script src="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-7093222719567591" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170170785-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-170170785-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://y2p.cc/" title="Yu Peng"><span class="octicon octicon-mark-github"></span> Yu Peng</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://y2p.cc/" class=" site-header-nav-item" target="" title="首页">首页</a> <a href="https://y2p.cc/categories/" class=" site-header-nav-item" target="" title="分类">分类</a> <a href="https://y2p.cc/notes/" class=" site-header-nav-item" target="" title="笔记">笔记</a> <a href="https://y2p.cc/about/" class=" site-header-nav-item" target="" title="关于">关于</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="DOCKERD CLI 代码解"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">DOCKERD CLI 代码解析</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2017/03/16 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://y2p.cc/categories/#Docker" title="Docker">Docker</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 7175 字，约 21 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><p>DOCKERD CLI 代码解析</p><h2 id="cobra示例">cobra示例</h2><p>docker将客户端程序和服务器程序分为docker和dockerd，两者的命令行解析都采用第三方库：<a href="https://github.com/spf13/cobra">cobra</a></p><p>首先用个<a href="../../../../2017/02/17/cobra/#little-example">小程序</a>介绍一下cobra的简单用法：</p><h2 id="基本用法是这四步">基本用法是这四步：</h2><ol><li>主命令</li><li>子命令</li><li>添加选项</li><li>执行命令</li></ol><h2 id="dockerd职责">dockerd职责</h2><p>docker接受并解析客户端的操作指令，然后访问dockerd相应的url，让dockerd做实际的处理。 dockerd实际上可简化为一个web后台，提供各种web接口API让docker访问。</p><h2 id="dockerd-cli-代码解析">dockerd cli 代码解析</h2><p>dcokerd的入口函数在文件docker/cmd/dockerd/docker.go中</p><h3 id="从main函数开始">从main函数开始</h3><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">reexec</span><span class="o">.</span><span class="n">Init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c">// Set terminal emulation based on platform as required.</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">:=</span> <span class="n">term</span><span class="o">.</span><span class="n">StdStreams</span><span class="p">()</span>
    <span class="n">logrus</span><span class="o">.</span><span class="n">SetOutput</span><span class="p">(</span><span class="n">stderr</span><span class="p">)</span>

    <span class="n">cmd</span> <span class="o">:=</span> <span class="n">newDaemonCommand</span><span class="p">()</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">SetOutput</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Execute</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="newdaemoncommand继续解析">newDaemonCommand继续解析</h3><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">newDaemonCommand</span><span class="p">()</span> <span class="o">*</span><span class="n">cobra</span><span class="o">.</span><span class="n">Command</span> <span class="p">{</span>
    <span class="n">opts</span> <span class="o">:=</span> <span class="n">daemonOptions</span><span class="p">{</span>
        <span class="n">daemonConfig</span><span class="o">:</span> <span class="n">config</span><span class="o">.</span><span class="n">New</span><span class="p">(),</span>
        <span class="n">common</span><span class="o">:</span>       <span class="n">cliflags</span><span class="o">.</span><span class="n">NewCommonOptions</span><span class="p">(),</span>
    <span class="p">}</span>

    <span class="c">// 主命令</span>
    <span class="n">cmd</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">cobra</span><span class="o">.</span><span class="n">Command</span><span class="p">{</span>
        <span class="n">Use</span><span class="o">:</span>           <span class="s">"dockerd [OPTIONS]"</span><span class="p">,</span>
        <span class="n">Short</span><span class="o">:</span>         <span class="s">"A self-sufficient runtime for containers."</span><span class="p">,</span>
        <span class="n">SilenceUsage</span><span class="o">:</span>  <span class="no">true</span><span class="p">,</span>
        <span class="n">SilenceErrors</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
        <span class="n">Args</span><span class="o">:</span>          <span class="n">cli</span><span class="o">.</span><span class="n">NoArgs</span><span class="p">,</span>
        <span class="n">RunE</span><span class="o">:</span> <span class="k">func</span><span class="p">(</span><span class="n">cmd</span> <span class="o">*</span><span class="n">cobra</span><span class="o">.</span><span class="n">Command</span><span class="p">,</span> <span class="n">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Flags</span><span class="p">()</span>

            <span class="c">// 主命令回调函数</span>
            <span class="k">return</span> <span class="n">runDaemon</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">cli</span><span class="o">.</span><span class="n">SetupRootCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

    <span class="n">flags</span> <span class="o">:=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">Flags</span><span class="p">()</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">BoolVarP</span><span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="o">.</span><span class="n">version</span><span class="p">,</span> <span class="s">"version"</span><span class="p">,</span> <span class="s">"v"</span><span class="p">,</span> <span class="no">false</span><span class="p">,</span> <span class="s">"Print version information and quit"</span><span class="p">)</span>

    <span class="c">// 默认配置文件，unix、linux为"/etc/docker/daemon.json"，windows和Solaris为""</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">StringVar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">opts</span><span class="o">.</span><span class="n">configFile</span><span class="p">,</span> <span class="n">flagDaemonConfigFile</span><span class="p">,</span> <span class="n">defaultDaemonConfigFile</span><span class="p">,</span> <span class="s">"Daemon configuration file"</span><span class="p">)</span>

    <span class="c">// 通过install，从flag获取选项值，并将相应值传到各个模块</span>
    <span class="c">// cli界面上的呈现的命令都能在以下函数中找到</span>
    <span class="n">opts</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">InstallFlags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
    <span class="n">installConfigFlags</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">daemonConfig</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>

    <span class="c">// 试验用</span>
    <span class="n">installServiceFlags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cmd</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="命令解析完就会执行函数rundaemon">命令解析完就会执行函数runDaemon</h3><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">runDaemon</span><span class="p">(</span><span class="n">opts</span> <span class="n">daemonOptions</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">version</span> <span class="p">{</span>
        <span class="n">showVersion</span><span class="p">()</span>
        <span class="k">return</span> <span class="no">nil</span>
    <span class="p">}</span>

    <span class="n">daemonCli</span> <span class="o">:=</span> <span class="n">NewDaemonCli</span><span class="p">()</span>

    <span class="c">// Windows specific settings as these are not defaulted.</span>
    <span class="k">if</span> <span class="n">runtime</span><span class="o">.</span><span class="n">GOOS</span> <span class="o">==</span> <span class="s">"windows"</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">daemonConfig</span><span class="o">.</span><span class="n">Pidfile</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">daemonConfig</span><span class="o">.</span><span class="n">Pidfile</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">daemonConfig</span><span class="o">.</span><span class="n">Root</span><span class="p">,</span> <span class="s">"docker.pid"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">configFile</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">configFile</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">daemonConfig</span><span class="o">.</span><span class="n">Root</span><span class="p">,</span> <span class="s">`config\daemon.json`</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c">// On Windows, this may be launching as a service or with an option to</span>
    <span class="c">// register the service.</span>
    <span class="c">// unix、linux下为空函数</span>
    <span class="n">stop</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">initService</span><span class="p">(</span><span class="n">daemonCli</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">logrus</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">stop</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">nil</span>
    <span class="p">}</span>

    <span class="c">// 启动一个server</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">daemonCli</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
    <span class="n">notifyShutdown</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="启动一个server">启动一个server</h3><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">cli</span> <span class="o">*</span><span class="n">DaemonCli</span><span class="p">)</span> <span class="n">start</span><span class="p">(</span><span class="n">opts</span> <span class="n">daemonOptions</span><span class="p">)</span> <span class="p">(</span><span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stopc</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">bool</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="n">stopc</span><span class="p">)</span>

    <span class="c">// warn from uuid package when running the daemon</span>
    <span class="n">uuid</span><span class="o">.</span><span class="n">Loggerf</span> <span class="o">=</span> <span class="n">logrus</span><span class="o">.</span><span class="n">Warnf</span>

    <span class="n">opts</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">SetDefaultOptions</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">loadDaemonCliConfig</span><span class="p">(</span><span class="n">opts</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="n">cli</span><span class="o">.</span><span class="n">configFile</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">opts</span><span class="o">.</span><span class="n">configFile</span>
    <span class="n">cli</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">flags</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">TrustKey</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">TrustKey</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span>
            <span class="n">getDaemonConfDir</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Root</span><span class="p">),</span>
            <span class="n">cliflags</span><span class="o">.</span><span class="n">DefaultTrustKeyFile</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Debug</span> <span class="p">{</span>
        <span class="n">debug</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Experimental</span> <span class="p">{</span>
        <span class="n">logrus</span><span class="o">.</span><span class="n">Warn</span><span class="p">(</span><span class="s">"Running experimental build"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">logrus</span><span class="o">.</span><span class="n">SetFormatter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">logrus</span><span class="o">.</span><span class="n">TextFormatter</span><span class="p">{</span>
        <span class="n">TimestampFormat</span><span class="o">:</span> <span class="n">jsonlog</span><span class="o">.</span><span class="n">RFC3339NanoFixed</span><span class="p">,</span>
        <span class="n">DisableColors</span><span class="o">:</span>   <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">RawLogs</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">setDefaultUmask</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Failed to set umask: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">LogConfig</span><span class="o">.</span><span class="n">Config</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">0</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">logger</span><span class="o">.</span><span class="n">ValidateLogOpts</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">LogConfig</span><span class="o">.</span><span class="n">Type</span><span class="p">,</span> <span class="n">cli</span><span class="o">.</span><span class="n">LogConfig</span><span class="o">.</span><span class="n">Config</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Failed to set log opts: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c">// Create the daemon root before we create ANY other files (PID, or migrate keys)</span>
    <span class="c">// to ensure the appropriate ACL is set (particularly relevant on Windows)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">daemon</span><span class="o">.</span><span class="n">CreateDaemonRoot</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Pidfile</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">{</span>
        <span class="n">pf</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">pidfile</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Pidfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Error starting daemon: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">pf</span><span class="o">.</span><span class="n">Remove</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
                <span class="n">logrus</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}()</span>
    <span class="p">}</span>

    <span class="n">serverConfig</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">apiserver</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
        <span class="n">Logging</span><span class="o">:</span>     <span class="no">true</span><span class="p">,</span>
        <span class="n">SocketGroup</span><span class="o">:</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">SocketGroup</span><span class="p">,</span>
        <span class="n">Version</span><span class="o">:</span>     <span class="n">dockerversion</span><span class="o">.</span><span class="n">Version</span><span class="p">,</span>
        <span class="n">EnableCors</span><span class="o">:</span>  <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">EnableCors</span><span class="p">,</span>
        <span class="n">CorsHeaders</span><span class="o">:</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">CorsHeaders</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">TLS</span> <span class="p">{</span>
        <span class="n">tlsOptions</span> <span class="o">:=</span> <span class="n">tlsconfig</span><span class="o">.</span><span class="n">Options</span><span class="p">{</span>
            <span class="n">CAFile</span><span class="o">:</span>   <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">CommonTLSOptions</span><span class="o">.</span><span class="n">CAFile</span><span class="p">,</span>
            <span class="n">CertFile</span><span class="o">:</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">CommonTLSOptions</span><span class="o">.</span><span class="n">CertFile</span><span class="p">,</span>
            <span class="n">KeyFile</span><span class="o">:</span>  <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">CommonTLSOptions</span><span class="o">.</span><span class="n">KeyFile</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">TLSVerify</span> <span class="p">{</span>
            <span class="c">// server requires and verifies client's certificate</span>
            <span class="n">tlsOptions</span><span class="o">.</span><span class="n">ClientAuth</span> <span class="o">=</span> <span class="n">tls</span><span class="o">.</span><span class="n">RequireAndVerifyClientCert</span>
        <span class="p">}</span>
        <span class="n">tlsConfig</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">tlsconfig</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">tlsOptions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">err</span>
        <span class="p">}</span>
        <span class="n">serverConfig</span><span class="o">.</span><span class="n">TLSConfig</span> <span class="o">=</span> <span class="n">tlsConfig</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Hosts</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
        <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Hosts</span> <span class="o">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">api</span> <span class="o">:=</span> <span class="n">apiserver</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">serverConfig</span><span class="p">)</span>
    <span class="n">cli</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">api</span>

    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Hosts</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">err</span> <span class="kt">error</span>
        <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Hosts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">err</span> <span class="o">=</span> <span class="n">dopts</span><span class="o">.</span><span class="n">ParseHost</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">TLS</span><span class="p">,</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Hosts</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"error parsing -H %s : %v"</span><span class="p">,</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Hosts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">err</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">protoAddr</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Hosts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">protoAddrParts</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">SplitN</span><span class="p">(</span><span class="n">protoAddr</span><span class="p">,</span> <span class="s">"://"</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">protoAddrParts</span><span class="p">)</span> <span class="o">!=</span> <span class="m">2</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"bad format %s, expected PROTO://ADDR"</span><span class="p">,</span> <span class="n">protoAddr</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">proto</span> <span class="o">:=</span> <span class="n">protoAddrParts</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
        <span class="n">addr</span> <span class="o">:=</span> <span class="n">protoAddrParts</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>

        <span class="c">// It's a bad idea to bind to TCP without tlsverify.</span>
        <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="s">"tcp"</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">serverConfig</span><span class="o">.</span><span class="n">TLSConfig</span> <span class="o">==</span> <span class="no">nil</span> <span class="o">||</span> <span class="n">serverConfig</span><span class="o">.</span><span class="n">TLSConfig</span><span class="o">.</span><span class="n">ClientAuth</span> <span class="o">!=</span> <span class="n">tls</span><span class="o">.</span><span class="n">RequireAndVerifyClientCert</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">logrus</span><span class="o">.</span><span class="n">Warn</span><span class="p">(</span><span class="s">"[!] DON'T BIND ON ANY IP ADDRESS WITHOUT setting --tlsverify IF YOU DON'T KNOW WHAT YOU'RE DOING [!]"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">ls</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">listeners</span><span class="o">.</span><span class="n">Init</span><span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">serverConfig</span><span class="o">.</span><span class="n">SocketGroup</span><span class="p">,</span> <span class="n">serverConfig</span><span class="o">.</span><span class="n">TLSConfig</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">err</span>
        <span class="p">}</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">wrapListeners</span><span class="p">(</span><span class="n">proto</span><span class="p">,</span> <span class="n">ls</span><span class="p">)</span>
        <span class="c">// If we're binding to a TCP port, make sure that a container doesn't try to use it.</span>
        <span class="k">if</span> <span class="n">proto</span> <span class="o">==</span> <span class="s">"tcp"</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">allocateDaemonPort</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">err</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">logrus</span><span class="o">.</span><span class="n">Debugf</span><span class="p">(</span><span class="s">"Listener created for HTTP on %s (%s)"</span><span class="p">,</span> <span class="n">proto</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
        <span class="n">api</span><span class="o">.</span><span class="n">Accept</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">ls</span><span class="o">...</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">migrateKey</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>

    <span class="c">// FIXME: why is this down here instead of with the other TrustKey logic above?</span>
    <span class="n">cli</span><span class="o">.</span><span class="n">TrustKeyPath</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">TrustKey</span>

    <span class="n">registryService</span> <span class="o">:=</span> <span class="n">registry</span><span class="o">.</span><span class="n">NewService</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">ServiceOptions</span><span class="p">)</span>
    <span class="n">containerdRemote</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">libcontainerd</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">getLibcontainerdRoot</span><span class="p">(),</span> <span class="n">cli</span><span class="o">.</span><span class="n">getPlatformRemoteOptions</span><span class="p">()</span><span class="o">...</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">Trap</span><span class="p">(</span><span class="k">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">cli</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="o">&lt;-</span><span class="n">stopc</span> <span class="c">// wait for daemonCli.start() to return</span>
    <span class="p">})</span>

    <span class="c">// Notify that the API is active, but before daemon is set up.</span>
    <span class="n">preNotifySystem</span><span class="p">()</span>

    <span class="n">d</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">daemon</span><span class="o">.</span><span class="n">NewDaemon</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="p">,</span> <span class="n">registryService</span><span class="p">,</span> <span class="n">containerdRemote</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Error starting daemon: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">MetricsAddress</span> <span class="o">!=</span> <span class="s">""</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">!</span><span class="n">d</span><span class="o">.</span><span class="n">HasExperimental</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"metrics-addr is only supported when experimental is enabled"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">startMetricsServer</span><span class="p">(</span><span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">MetricsAddress</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">err</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Hostname</span><span class="p">()</span>

    <span class="n">c</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
        <span class="n">Root</span><span class="o">:</span>                   <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">Root</span><span class="p">,</span>
        <span class="n">Name</span><span class="o">:</span>                   <span class="n">name</span><span class="p">,</span>
        <span class="n">Backend</span><span class="o">:</span>                <span class="n">d</span><span class="p">,</span>
        <span class="n">NetworkSubnetsProvider</span><span class="o">:</span> <span class="n">d</span><span class="p">,</span>
        <span class="n">DefaultAdvertiseAddr</span><span class="o">:</span>   <span class="n">cli</span><span class="o">.</span><span class="n">Config</span><span class="o">.</span><span class="n">SwarmDefaultAdvertiseAddr</span><span class="p">,</span>
        <span class="n">RuntimeRoot</span><span class="o">:</span>            <span class="n">cli</span><span class="o">.</span><span class="n">getSwarmRunRoot</span><span class="p">(),</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">logrus</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"Error creating cluster component: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c">// Restart all autostart containers which has a swarm endpoint</span>
    <span class="c">// and is not yet running now that we have successfully</span>
    <span class="c">// initialized the cluster.</span>
    <span class="n">d</span><span class="o">.</span><span class="n">RestartSwarmContainers</span><span class="p">()</span>

    <span class="n">logrus</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">"Daemon has completed initialization"</span><span class="p">)</span>

    <span class="n">logrus</span><span class="o">.</span><span class="n">WithFields</span><span class="p">(</span><span class="n">logrus</span><span class="o">.</span><span class="n">Fields</span><span class="p">{</span>
        <span class="s">"version"</span><span class="o">:</span>     <span class="n">dockerversion</span><span class="o">.</span><span class="n">Version</span><span class="p">,</span>
        <span class="s">"commit"</span><span class="o">:</span>      <span class="n">dockerversion</span><span class="o">.</span><span class="n">GitCommit</span><span class="p">,</span>
        <span class="s">"graphdriver"</span><span class="o">:</span> <span class="n">d</span><span class="o">.</span><span class="n">GraphDriverName</span><span class="p">(),</span>
    <span class="p">})</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">"Docker daemon"</span><span class="p">)</span>

    <span class="n">cli</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span>

    <span class="c">// initMiddlewares needs cli.d to be populated. Dont change this init order.</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cli</span><span class="o">.</span><span class="n">initMiddlewares</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">serverConfig</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="n">logrus</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s">"Error creating middlewares: %v"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">d</span><span class="o">.</span><span class="n">SetCluster</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">initRouter</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="n">cli</span><span class="o">.</span><span class="n">setupConfigReloadTrap</span><span class="p">()</span>

    <span class="c">// The serve API routine never exits unless an error occurs</span>
    <span class="c">// We need to start it as a goroutine and wait on it so</span>
    <span class="c">// daemon doesn't exit</span>
    <span class="n">serveAPIWait</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">error</span><span class="p">)</span>
    <span class="k">go</span> <span class="n">api</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">serveAPIWait</span><span class="p">)</span>

    <span class="c">// after the daemon is done setting up we can notify systemd api</span>
    <span class="n">notifySystem</span><span class="p">()</span>

    <span class="c">// Daemon is fully initialized and handling API traffic</span>
    <span class="c">// Wait for serve API to complete</span>
    <span class="n">errAPI</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">serveAPIWait</span>
    <span class="n">c</span><span class="o">.</span><span class="n">Cleanup</span><span class="p">()</span>
    <span class="n">shutdownDaemon</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">containerdRemote</span><span class="o">.</span><span class="n">Cleanup</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">errAPI</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"Shutting down due to ServeAPI error: %v"</span><span class="p">,</span> <span class="n">errAPI</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre></div></div><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://y2p.cc" target="_blank">Yu Peng</a></li><li>本文链接：<a href="https://y2p.cc/2017/03/16/dockerd-cli/" target="_blank">https://y2p.cc/2017/03/16/dockerd-cli/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"><div class="share-component" data-disabled='qq,facebook'></div></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2017/03/16/dockerd-cli/', clientID: 'b2ad054f2e4daf7ad564', clientSecret: 'c742e4086336e58b70e0e88dc791e5bce6e37330', repo: 'blog-comments', owner: 'yu3peng', admin: ['yu3peng'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@built/assets/search_data.json?v=1651905387', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 30, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2022 <span title="Yu Peng">Yu Peng</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/yu3peng/yu3peng.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://y2p.cc/" title="首页" target="">首页</a></li><li> <a href="https://y2p.cc/categories/" title="分类" target="">分类</a></li><li> <a href="https://y2p.cc/notes/" title="笔记" target="">笔记</a></li><li> <a href="https://y2p.cc/about/" title="关于" target="">关于</a></li><li><a href="https://y2p.cc/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/yu3peng/yu3peng.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
